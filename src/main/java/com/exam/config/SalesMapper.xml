<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.exam.config.SalesMapper">

	<select id="findHourlySales" resultType="HourlySalesDTO">
		select sum(sale_price) as totalSale, hour(sale_date) as saleHour
		from Sales
		group by hour(sale_date)
		order by hour(sale_date)
	</select>

	<select id="findDailySales" resultType="DailySalesDTO">
		select sum(sale_price) as totalSale, date(sale_date) as saleDate
		from Sales
		group by date(sale_date)
		order by date(sale_date)
	</select>

	<select id="findWeeklySales" resultType="WeeklySalesDTO">
		select sum(sale_price) as totalSale, week(sale_date) as saleWeek, year(sale_date) as saleYear
		from Sales
		group by year(sale_date), week(sale_date)
		order by week(sale_date), year(sale_date)
	</select>

	<select id="findMonthlySales" resultType="MonthlySalesDTO">
		select sum(sale_price) as totalSale, month(sale_date) as saleMonth, year(sale_date) as saleYear
		from Sales
		group by year(sale_date), month(sale_date)
		order by year(sale_date), month(sale_date)
	</select>

	<select id="findYearlySales" resultType="YearlySalesDTO">
		select sum(sale_price) as totalSale, year(sale_date) as saleYear
		from Sales
		group by year(sale_date)
		order by year(sale_date)
	</select>

	<select id="findSalesByHour" resultType="HourlySalesDTO" parameterType="int">
		select sum(sale_price) as totalSale, hour(sale_date) as saleHour
		from Sales
		where hour(sale_date) = #{hour}
		group by hour(sale_date)
	</select>

	<!-- 특정 날짜 시간대별 매출 조회 -->
	<select id="findHourlySalesByDate" resultType="DailySalesDTO" parameterType="java.time.LocalDate">
		select sum(sale_price) as totalSale, date(sale_date) as saleDate, hour(sale_date) as saleHour
		from Sales
		where date(sale_date) = #{date}
		group by date(sale_date), hour(sale_date)
		order by hour(sale_date)
	</select>
	
	<select id="findSalesByDate" resultType="DailySalesDTO" parameterType="java.time.LocalDate">
		select sum(sale_price) as totalSale, date(sale_date) as saleDate
		from Sales
		where date(sale_date) = #{date}
		group by date(sale_date)
	</select>
	
	<!-- 최근 일주일 매출 조회 -->
	<select id="findRecentWeekSales" resultType="DailySalesDTO">
		<![CDATA[
    		select sum(sale_price) as totalSale, date(sale_date) as saleDate
    		from Sales
    		where sale_date >= date_sub(curdate(), interval 1 week) and sale_date <= curdate()
    		group by date(sale_date)
    		order by saleDate
    	]]>
	</select>

	<select id="findSalesByMonth" resultType="MonthlySalesDTO" parameterType="int">
		select sum(sale_price) as totalSale, month(sale_date) as saleMonth, year(sale_date) as saleYear
		from Sales
		where year(sale_date) = #{year} and month(sale_date) = #{month}
		group by year(sale_date), month(sale_date)
	</select>

	<select id="findSalesByYear" resultType="YearlySalesDTO" parameterType="int">
		select sum(sale_price) as totalSale, year(sale_date) as saleYear
		from Sales
		where year(sale_date) = #{year}
		group by year(sale_date)
	</select>

</mapper>